<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BIO144 Course Book - ANOVA (L6)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./8-ANCOVA.html" rel="next">
<link href="./6-interactions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./7-ANOVA.html">ANOVA (L6)</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">BIO144 Course Book</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction (L1)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-data-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data wrangling (L2)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression (L3&amp;4)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-multiple-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple regression (L4)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-categorical-explanatory-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical explanatory variables (L5)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactions (L5)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-ANOVA.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ANOVA (L6)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-ANCOVA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANCOVA (L7)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-linear-algebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear algebra (L7)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-variable-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable selection (L8)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-interpretation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intepretation, causality, and cautionary notes (L9)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-count-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Count data (L10)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-binary-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Binary data (L11)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-measurement-error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Measurement error (L12)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-mixed-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixed models (L12)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-what-next.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What next (L12)</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#understanding-anlysis-of-variance-anova" id="toc-understanding-anlysis-of-variance-anova" class="nav-link" data-scroll-target="#understanding-anlysis-of-variance-anova">Understanding anlysis of variance (ANOVA)</a>
  <ul class="collapse">
  <li><a href="#rewrite-the-model" id="toc-rewrite-the-model" class="nav-link" data-scroll-target="#rewrite-the-model">Rewrite the model</a></li>
  <li><a href="#the-anova-test-the-f-test" id="toc-the-anova-test-the-f-test" class="nav-link" data-scroll-target="#the-anova-test-the-f-test">The ANOVA test: The <span class="math inline">\(F\)</span>-test</a></li>
  <li><a href="#calculating-and-analysing-the-variances" id="toc-calculating-and-analysing-the-variances" class="nav-link" data-scroll-target="#calculating-and-analysing-the-variances">Calculating and analysing the variances</a></li>
  <li><a href="#interpretation-of-the-f-statistic" id="toc-interpretation-of-the-f-statistic" class="nav-link" data-scroll-target="#interpretation-of-the-f-statistic">Interpretation of the <span class="math inline">\(F\)</span> statistic</a></li>
  <li><a href="#interpretation-of-the-f-statistic-ii" id="toc-interpretation-of-the-f-statistic-ii" class="nav-link" data-scroll-target="#interpretation-of-the-f-statistic-ii">Interpretation of the <span class="math inline">\(F\)</span> statistic II</a></li>
  <li><a href="#source-of-variance-table" id="toc-source-of-variance-table" class="nav-link" data-scroll-target="#source-of-variance-table">Source of variance table</a></li>
  </ul></li>
  <li><a href="#doing-anova-in-r" id="toc-doing-anova-in-r" class="nav-link" data-scroll-target="#doing-anova-in-r">Doing ANOVA in R</a>
  <ul class="collapse">
  <li><a href="#difference-between-pairs-of-groups" id="toc-difference-between-pairs-of-groups" class="nav-link" data-scroll-target="#difference-between-pairs-of-groups">Difference between pairs of groups</a></li>
  <li><a href="#bonferroni-correction" id="toc-bonferroni-correction" class="nav-link" data-scroll-target="#bonferroni-correction">Bonferroni correction</a></li>
  <li><a href="#tukey-hsd-approach" id="toc-tukey-hsd-approach" class="nav-link" data-scroll-target="#tukey-hsd-approach">Tukey HSD approach</a></li>
  <li><a href="#fishers-lsd-approach" id="toc-fishers-lsd-approach" class="nav-link" data-scroll-target="#fishers-lsd-approach">Fisher’s LSD approach</a></li>
  <li><a href="#other-contrasts" id="toc-other-contrasts" class="nav-link" data-scroll-target="#other-contrasts">Other contrasts</a></li>
  <li><a href="#choosing-the-reference-category" id="toc-choosing-the-reference-category" class="nav-link" data-scroll-target="#choosing-the-reference-category">Choosing the reference category</a></li>
  </ul></li>
  <li><a href="#two-way-anova-zweiweg-varianzanalyse" id="toc-two-way-anova-zweiweg-varianzanalyse" class="nav-link" data-scroll-target="#two-way-anova-zweiweg-varianzanalyse">Two-way ANOVA (Zweiweg-Varianzanalyse)</a>
  <ul class="collapse">
  <li><a href="#the-model-for-2-way-anova" id="toc-the-model-for-2-way-anova" class="nav-link" data-scroll-target="#the-model-for-2-way-anova">The model for 2-way ANOVA</a></li>
  <li><a href="#using-r-for-2-way-anova" id="toc-using-r-for-2-way-anova" class="nav-link" data-scroll-target="#using-r-for-2-way-anova">Using R for 2-way ANOVA</a></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing">Hypothesis testing</a></li>
  </ul></li>
  <li><a href="#think-pair-share-1" id="toc-think-pair-share-1" class="nav-link" data-scroll-target="#think-pair-share-1">Think, Pair, Share</a></li>
  <li><a href="#interpreting-coefficients" id="toc-interpreting-coefficients" class="nav-link" data-scroll-target="#interpreting-coefficients">Interpreting coefficients</a></li>
  <li><a href="#why-not-perform-multiple-t-tests" id="toc-why-not-perform-multiple-t-tests" class="nav-link" data-scroll-target="#why-not-perform-multiple-t-tests">Why not perform multiple <span class="math inline">\(t\)</span>-tests?</a></li>
  <li><a href="#summing-up" id="toc-summing-up" class="nav-link" data-scroll-target="#summing-up">Summing up</a></li>
  <li><a href="#additional-reading" id="toc-additional-reading" class="nav-link" data-scroll-target="#additional-reading">Additional reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ANOVA (L6)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This chapter contains the content of the sixth lecture of the course BIO144 Data Analysis in Biology at the University of Zurich.</p>
<ul>
<li>One-way ANOVA</li>
<li>Post-hoc tests and contrasts</li>
<li>Two-way ANOVA</li>
</ul>
<p>ANOVA = ANalysis Of VAriance (Varianzanalyse)</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Analysis of variance is a method to compare the means of more than two groups. We already know a lot about analysing variance: we compared the total sum of squares (SST), model sum of squares (SSM) and the residual sum of squares (SSE) in the context of linear regression. We used these to calculated the <span class="math inline">\(R^2\)</span> value and the <span class="math inline">\(F\)</span>-statistic. To calculate the F-statistic we used the formula <span class="math inline">\(F = \frac{MSM}{MSE}\)</span>, where <span class="math inline">\(MSM\)</span> is the mean square of the model and <span class="math inline">\(MSE\)</span> is the mean square of the residuals. The mean square is a measure of variance.</p>
<p>Analysis of variance is a special case of a linear model, so much of what we already learned about linear models still holds.</p>
<p>The defining characteristic of ANOVA is that we are comparing the means of more than two groups. Put another way, we will have a single categorical explanatory variable with more than two levels. We will test whether the means of the response variable are the same across all levels of the explanatory variable.</p>
<p>When we have only one categorical explanatory variable, we will use a one-way ANOVA. When we have two categorical explanatory variables, we will use a two-way ANOVA (we’ll look at this in the second half of this chapter).</p>
<p>We have already looked at categorical variables with more than two groups. Let us recap that material from lecture 5.</p>
</section>
<section id="understanding-anlysis-of-variance-anova" class="level2">
<h2 class="anchored" data-anchor-id="understanding-anlysis-of-variance-anova">Understanding anlysis of variance (ANOVA)</h2>
<p>In ANOVA, we often talk of <em>within-group variance</em>, <em>between-group variance</em>, and <em>total variance</em>. These are not new things:</p>
<ul>
<li>Within-group variance is the variance of the residuals, <span class="math inline">\(MS_{residual}\)</span>.</li>
<li>Between-group variance is the variance of the group means, <span class="math inline">\(MS_{model}\)</span>.</li>
</ul>
<p>We formulate a model as follows: <span class="math display">\[y_{ij} = \mu_j + \epsilon_{i}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(y_{ij}\)</span> = Blood pressure of individual <span class="math inline">\(i\)</span> with diet <span class="math inline">\(j\)</span></li>
<li><span class="math inline">\(\mu_i\)</span> = Mean blood pressure of an individual with diet <span class="math inline">\(j\)</span></li>
<li><span class="math inline">\(\epsilon_{i}\sim N(0,\sigma^2)\)</span> is an independent error term.</li>
</ul>
<p>Graphically, with the blood pressure and diet data, this looks like:</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'diet'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<section id="rewrite-the-model" class="level3">
<h3 class="anchored" data-anchor-id="rewrite-the-model">Rewrite the model</h3>
<p>One common way to rewrite the model is to define one of the groups as the reference group, and make the mean of that equal to the intercept of the model:</p>
<p><span class="math display">\[\mu_{meat} = \beta_0\]</span></p>
<p>And then to express the other group means as deviations from the reference group mean:</p>
<p><span class="math display">\[\mu_{Med} = \beta_0 + \beta_1\]</span> <span class="math display">\[\mu_{vegan} = \beta_0 + \beta_2\]</span> <span class="math display">\[\mu_{veggi} = \beta_0 + \beta_3\]</span></p>
<p>When we write out the entire model, we get:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 x_i^{1} + \beta_2 x_i^{2} + \beta_3 x_i^{3} + \epsilon_i\]</span> where: <span class="math inline">\(y_i\)</span> is the blood pressure of individual <span class="math inline">\(i\)</span>. <span class="math inline">\(x_i^{1}\)</span> is a binary variable indicating whether individual <span class="math inline">\(i\)</span> is on the Mediterranean diet. <span class="math inline">\(x_i^{2}\)</span> is a binary variable indicating whether individual <span class="math inline">\(i\)</span> is on the vegan diet. <span class="math inline">\(x_i^{3}\)</span> is a binary variable indicating whether individual <span class="math inline">\(i\)</span> is on the vegetarian diet.</p>
<p>Graphically, the model now looks like this:</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'diet'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This looks exactly like the graph and model we made before while learning about categorical variables in Lecture 5. It is! There is nothing different here.</p>
</div>
</div>
</section>
<section id="the-anova-test-the-f-test" class="level3">
<h3 class="anchored" data-anchor-id="the-anova-test-the-f-test">The ANOVA test: The <span class="math inline">\(F\)</span>-test</h3>
<p><strong>Aim of ANOVA</strong>: to test <em>globally</em> if the groups differ. That is we want to test the null hypothesis that all of the group means are equal:</p>
<p><span class="math display">\[H_0: \mu_1=\mu_2=\ldots = \mu_g\]</span> This is equivalent to testing if all <span class="math inline">\(\beta\)</span>s that belong to a categorical variable are =0.</p>
<p><span class="math display">\[H_0: \beta_1 = \ldots = \beta_{g-1} = 0\]</span> The alternate hypothesis is that <span class="math inline">\({H_1}\)</span>: The group means are not all the same.</p>
<p>A key point is that we are testing a null hypothesis that concerns all the groups. We are not testing if one group is different from another group (which we could do with a <span class="math inline">\(t\)</span>-test on one of the non-intercept <span class="math inline">\(\beta\)</span>s).</p>
<p>Because we are testing a null hypothesis that concerns all the groups, we need to use an <span class="math inline">\(F\)</span>-test. It asks if the model with the group means is better than a model with just the overall mean.</p>
</section>
<section id="calculating-and-analysing-the-variances" class="level3">
<h3 class="anchored" data-anchor-id="calculating-and-analysing-the-variances">Calculating and analysing the variances</h3>
<p>To derive the ingredients of the <span class="math inline">\(F\)</span>-test, we look at the variances :</p>
<p><strong>Total variability:</strong> SST = <span class="math inline">\(\sum_{i=1}^k \sum_{j=1}^{n_i} (y_{ij}-\overline{y})^2\)</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(y_{ij}\)</span> is the blood pressure of individual <span class="math inline">\(j\)</span> in group <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(\overline{y}\)</span> is the overall mean blood pressure</li>
<li><span class="math inline">\(n_i\)</span> is the number of individuals in group <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(k\)</span> is the number of groups</li>
</ul>
<p><strong>Explained variability (between group variability)</strong>: == SSM = <span class="math inline">\(\sum_{i=1}^k n_i (\overline{y}_{i} - \overline{y})^2\)</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\overline{y}_{i}\)</span> is the mean blood pressure of group <span class="math inline">\(i\)</span></li>
</ul>
<p>*Residual variability (within group variability)**: = SSE = <span class="math inline">\(\sum_{i=1}^k \sum_{j=1}^{n_i} (y_{ij} - \overline{y}_{i} )^2\)</span></p>
<p>*SST degrees of freedom**: <span class="math inline">\(n - 1\)</span> (total degrees of freedom is number of observations <span class="math inline">\(n\)</span> minus 1)</p>
<p>*SSM degrees of freedom**: <span class="math inline">\(k - 1\)</span> (model degrees of freedom is number of groups <span class="math inline">\(k\)</span> minus 1)</p>
<p>*SSE degrees of freedom**: <span class="math inline">\(n - k\)</span> (residual degrees of freedom is total degrees of freedom <span class="math inline">\(n - 1\)</span> minus model degrees of freedom <span class="math inline">\(k - 1\)</span>)</p>
<p>From these sums of squares and degrees of freedom we can calculate the mean squares and <span class="math inline">\(F\)</span>-statistic:</p>
<p><span class="math display">\[MS_{model} = \frac{SS_{\text{between}}}{k-1} = \frac{SSM}{k-1}\]</span></p>
<p><span class="math display">\[MS_{residual} = \frac{SS_{\text{within}}}{n-k} = \frac{SSE}{n-k}\]</span></p>
<p><span class="math display">\[F = \frac{MS_{model}}{MS_{residual}}\]</span></p>
</section>
<section id="interpretation-of-the-f-statistic" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-the-f-statistic">Interpretation of the <span class="math inline">\(F\)</span> statistic</h3>
<ul>
<li><span class="math inline">\(MS_{model}\)</span>: Quantifies the variability <strong>between</strong> groups.</li>
<li><span class="math inline">\(MS_{residual}\)</span>: Quantifies the variability <strong>within</strong> groups.</li>
</ul>
<p>Here is an example with very low within group variability, and high between group variability:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>And here’s an example with very high within group variability, and low between group variability:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="480"></p>
</div>
</div>
</section>
<section id="interpretation-of-the-f-statistic-ii" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-the-f-statistic-ii">Interpretation of the <span class="math inline">\(F\)</span> statistic II</h3>
<ul>
<li><strong><span class="math inline">\(F\)</span> increases</strong>
<ul>
<li>when the group means become more different, or</li>
<li>when the variability within groups decreases.</li>
</ul></li>
<li><strong><span class="math inline">\(F\)</span> decreases</strong>
<ul>
<li>when the group means become more similar, or</li>
<li>when the variability within groups increases.</li>
</ul></li>
</ul>
<p><span class="math inline">\(\rightarrow\)</span> The larger <span class="math inline">\(F\)</span>, the less likely are the data seen under <span class="math inline">\(H_0\)</span>.</p>
</section>
<section id="source-of-variance-table" class="level3">
<h3 class="anchored" data-anchor-id="source-of-variance-table">Source of variance table</h3>
<p>The <strong>sources of variance table</strong> is a table that conveniently and clearly gives all of the quantities mentioned above. It breaks down the total sum of squares into the sum of squares explained by the model and the sum of squares due to error. The source of variance table is used to calculate the <span class="math inline">\(F\)</span>-statistic.</p>
<table class="table">
<caption>Sources of variance table</caption>
<colgroup>
<col style="width: 7%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 30%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>Source</th>
<th>Sum of squares</th>
<th>Degrees of freedom</th>
<th>Mean square</th>
<th>F-statistic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Model</td>
<td><span class="math inline">\(SSM\)</span></td>
<td><span class="math inline">\(k-1\)</span></td>
<td><span class="math inline">\(MSE_{model} = SSM / k-1\)</span></td>
<td><span class="math inline">\(\frac{MSE_{model}}{MSE_{error}}\)</span></td>
</tr>
<tr class="even">
<td>Error</td>
<td><span class="math inline">\(SSE\)</span></td>
<td><span class="math inline">\(n - 1 - (k-1)\)</span></td>
<td><span class="math inline">\(MSE_{error} = SSE / (n - 1 - (k-1))\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td>Total</td>
<td><span class="math inline">\(SST\)</span></td>
<td><span class="math inline">\(n - 1\)</span></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="doing-anova-in-r" class="level2">
<h2 class="anchored" data-anchor-id="doing-anova-in-r">Doing ANOVA in R</h2>
<p>Let’s go back again the question of how diet effects blood pressure. Here is the data:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
     bp diet          person_ID
  &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;    
1   120 meat heavy    person_1 
2    89 vegan         person_2 
3    86 vegetarian    person_3 
4   116 meat heavy    person_4 
5   115 Mediterranean person_5 
6   134 meat heavy    person_6 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>And here is how we fit a linear model to this data:</p>
<p>Next we check the diagnostic plots:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Nothing looks too bad.</p>
<p>Now we can look at the ANOVA table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: bp
          Df Sum Sq Mean Sq F value    Pr(&gt;F)    
diet       3 5274.2 1758.08  20.728 1.214e-08 ***
Residuals 46 3901.5   84.82                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>A suitable sentence to report our findings would be: “Diet has a significant effect on blood pressure (<span class="math inline">\(F(2, 27) = 20.7, p &lt; 0.0001\)</span>)”. This means that the probability of observing such a large <span class="math inline">\(F\)</span> value under the null hypothesis is less than 0.01%.</p>
<section id="difference-between-pairs-of-groups" class="level3">
<h3 class="anchored" data-anchor-id="difference-between-pairs-of-groups">Difference between pairs of groups</h3>
<p>If the <span class="math inline">\(F\)</span>-test of the null hypothesis that <span class="math inline">\(\beta_1=\ldots= \beta_{g-1}=0\)</span> is rejected, a researcher might then be interested:</p>
<ol type="1">
<li>in finding the actual group(s) that deviate(s) from the others.</li>
<li>in estimates of the pairwise differences.</li>
</ol>
<p>The summary table in R provides some of these comparison, specifically it contains the estimates for <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, <span class="math inline">\(\beta_3\)</span> (while the reference was set to <span class="math inline">\(\beta_0 = 0\)</span>). These three <span class="math inline">\(\beta\)</span> values are the differences between the group means and the reference group mean. We can test if these differences are significantly different from zero using a <span class="math inline">\(t\)</span>-test, as you’ve see before.</p>
<p>However, there are two issues:</p>
<ol type="1">
<li><p>The more tests you do, the more likely you are to find a significant result just by chance. This is called the problem of multiple comparisons. Many test can result in a type-I error: rejecting the null hypothesis when it is actually true. The more tests one does, the more likely one is to make a type-I error.</p></li>
<li><p>The summary table does not provide all the possible pairwise comparisons. It does not, for example, provide the comparison between the “vegan” and the “vegetarian” group.</p></li>
</ol>
<p>Several methods to circumvent the problem of too many “significant” test results (type-I error) have been proposed. The most prominent ones are:</p>
<ul>
<li>Bonferroni correction</li>
<li>Tukey <strong>H</strong>onest <strong>S</strong>ignificant <strong>D</strong>ifferences (HSD) approach</li>
<li>Fisher <strong>L</strong>east <strong>S</strong>ignificant <strong>D</strong>ifferences (LSD) approach</li>
</ul>
</section>
<section id="bonferroni-correction" class="level3">
<h3 class="anchored" data-anchor-id="bonferroni-correction">Bonferroni correction</h3>
<p><strong>Idea:</strong> If a total of <span class="math inline">\(m\)</span> tests are carried out, simply divide the type-I error level <span class="math inline">\(\alpha_0\)</span> (often 5%) such that</p>
<p><span class="math display">\[\alpha = \alpha_0 / m \ .\]</span></p>
</section>
<section id="tukey-hsd-approach" class="level3">
<h3 class="anchored" data-anchor-id="tukey-hsd-approach">Tukey HSD approach</h3>
<p><strong>Idea:</strong> Take into account the distribution of (max-min) and design a new test.</p>
</section>
<section id="fishers-lsd-approach" class="level3">
<h3 class="anchored" data-anchor-id="fishers-lsd-approach">Fisher’s LSD approach</h3>
<p><strong>Idea:</strong> Adjust the idea of a two-sample test, but use a larger variance (namely the pooled variance of all groups).</p>
</section>
<section id="other-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="other-contrasts">Other contrasts</h3>
<p>We can design other contrasts, for example: are diets that contain meat different from diets that do not contain meat?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
     bp diet          person_ID meat_or_no_meat
  &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt;          
1   120 meat heavy    person_1  no meat        
2    89 vegan         person_2  no meat        
3    86 vegetarian    person_3  no meat        
4   116 meat heavy    person_4  no meat        
5   115 Mediterranean person_5  meat           
6   134 meat heavy    person_6  no meat        </code></pre>
</div>
</div>
<p>Here we defined a new explanatory variable that groups the meat heavy and Mediterranean diet together into a single “meat” group and vegetarian and vegan into a single “no meat” group. We then fit a model with this explanatory variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fit_mnm <span class="ot">&lt;-</span> <span class="fu">lm</span>(bp <span class="sc">~</span> meat_or_no_meat, <span class="at">data =</span> bp_data_diet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(We should not look at model diagnostics here, before using the model. But let us continue as if the assumptions are sufficiently met.)</p>
<p>We now do something a bit more complicated: we compare the variance explained by the model with four diets to the model with two diets. This is done by comparing the two models using an <span class="math inline">\(F\)</span>-test. We are testing the null hypothesis that the two models are equally good at explaining the data, in which case the two diet model will explain as much variance as the four diet model.</p>
<p>Let’s look at the ANOVA table of the model comparison:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit, fit_mnm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: bp ~ diet
Model 2: bp ~ meat_or_no_meat
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1     46 3901.5                                  
2     48 9173.4 -2   -5271.9 31.078 2.886e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We see the residual sum of squares of the model with meat or no meat is over 9’000, while that of the four diet model is less than 4’000. That is, the four diet model explains much more variance in the data than the two diet model. The <span class="math inline">\(F\)</span>-test is highly significant, so we reject the null hypothesis that the two models are equally good at explaining the data. And we conclude that its not just whether people eat meat or not, but rather what kind of diet they eat that affects their blood pressure.</p>
<p>Ideally we do not make a lot of contrasts after we have collected and looked at our data. Rather, we would specify the contrasts we are interested in before we collect the data. This is called a priori contrasts. But sometimes we do exploratory data analysis and then we can make post hoc contrasts. In this case we should be careful to adjust for multiple comparisons.</p>
</section>
<section id="choosing-the-reference-category" class="level3">
<h3 class="anchored" data-anchor-id="choosing-the-reference-category">Choosing the reference category</h3>
<p><strong>Question</strong>: Why was the “heavy meat” diet chosen as the reference (intercept) category?</p>
<p><strong>Answer</strong>: Because R orders the categories alphabetically and takes the first level alphabetically as reference category.</p>
<p>Sometimes we may want to override this, for example if we have a treatment that is experimentally the control, then it will usually be useful to set this as the reference / intercept level.</p>
<p>In R we can set the reference level using the <code>relevel</code> function:</p>
<p>And now make the model and look at the estimated coefficients:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bp ~ diet, data = bp_data_diet)

Residuals:
     Min       1Q   Median       3Q      Max 
-17.9375  -5.9174  -0.4286   5.2969  22.3750 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         95.857      3.481  27.538  &lt; 2e-16 ***
dietmeat heavy      26.768      4.173   6.414 6.92e-08 ***
dietMediterranean   14.080      4.173   3.374  0.00151 ** 
dietvegetarian       3.143      4.453   0.706  0.48386    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.21 on 46 degrees of freedom
Multiple R-squared:  0.5748,    Adjusted R-squared:  0.5471 
F-statistic: 20.73 on 3 and 46 DF,  p-value: 1.214e-08</code></pre>
</div>
</div>
<p>Now we see the estimated coefficients for all diets except the vegan diet. The intercept is the mean individuals with vegan diet.</p>
</section>
</section>
<section id="two-way-anova-zweiweg-varianzanalyse" class="level2">
<h2 class="anchored" data-anchor-id="two-way-anova-zweiweg-varianzanalyse">Two-way ANOVA (Zweiweg-Varianzanalyse)</h2>
<p>Two-way ANOVA is used to analyse a specific type of study design. When we have a study with two categorical treatments and all possible combinations of them, we can use a two-way ANOVA.</p>
<p>For example, take the question of how diet and exercise affect blood pressure. Let’s say we can have three levels of diet: meat heavy, Mediterranean, and vegetarian. And that we have two levels of exercise: low and high. And that we have all possible combinations of these two treatments: i.e., we have a total of <span class="math inline">\(3 \times 2 = 6\)</span> <strong>treatment combinations</strong>.</p>
<p>We can also represent this study design in a table:</p>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-fymr{border-color:inherit;font-weight:bold;text-align:left;vertical-align:top}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
</style>

<table class="tg">
<thead>
<tr>
<th class="tg-fymr">
</th>
<th class="tg-fymr" colspan="2">
Exercise (G)
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-0pky">
Diet (B)
</td>
<td class="tg-0pky">
Low (1)
</td>
<td class="tg-0pky">
High (2)
</td>
</tr>
<tr>
<td class="tg-0pky">
Meat heavy (1)
</td>
<td class="tg-0pky">
</td>
<td class="tg-0pky">
</td>
</tr>
<tr>
<td class="tg-0pky">
Mediterranean (2)
</td>
<td class="tg-0pky">
</td>
<td class="tg-0pky">
</td>
</tr>
<tr>
<td class="tg-0pky">
Vegetarian (3)
</td>
<td class="tg-0pky">
</td>
<td class="tg-0pky">
</td>
</tr>
</tbody>

</table>
<p>The six empty cells in the table represent the six treatment combinations.</p>
<p>This type of study, with all possible combinations, is known as a <em>factorial design</em>. The two treatments are called factors, and the levels of the factors are called factor levels. A <em>fully factorial design</em> is one where all possible combinations of the factor levels are present.</p>
<p>Let’s look at example data:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  diet          exercise  reps    bp
  &lt;chr&gt;         &lt;fct&gt;    &lt;int&gt; &lt;dbl&gt;
1 Mediterranean high         1  110.
2 Mediterranean low          1  119.
3 meat heavy    high         1  102.
4 meat heavy    low          1  128.
5 vegetarian    high         1  104.
6 vegetarian    low          1  111.</code></pre>
</div>
</div>
<p>We can use the <code>xtabs</code> function to create a table of the data, by cross-tabulating the two treatments diet and exercise:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span>diet <span class="sc">+</span> exercise, <span class="at">data =</span> bp_data_2cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               exercise
diet            low high
  meat heavy     10   10
  Mediterranean  10   10
  vegetarian     10   10</code></pre>
</div>
</div>
<p>This tells us there are 10 replicates in each of the six treatment combinations.</p>
<p>And a visualisation of the data:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think, Pair, Share
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you conclude from this plot?</p>
</div>
</div>
<section id="the-model-for-2-way-anova" class="level3">
<h3 class="anchored" data-anchor-id="the-model-for-2-way-anova">The model for 2-way ANOVA</h3>
<p>Assume we have a factorial design with two treatments (factors), factor <span class="math inline">\(B\)</span> and factor <span class="math inline">\(G\)</span>.</p>
<p>And that we can label the levels of factor <span class="math inline">\(B\)</span> as <span class="math inline">\(i=1,2...\)</span> and factor <span class="math inline">\(\G\)</span> as <span class="math inline">\(j=1,2...\)</span>.</p>
<p>Then we can denote a particular treatment combination as <span class="math inline">\(B_iG_j\)</span>.</p>
<p>And let us set the one of the treatment combinations as the intercept of the model, and the let the intercept be equal to the mean of the observations in the treatment combination <span class="math inline">\(B1G1\)</span>.</p>
<p><span class="math display">\[intercept = \frac{1}{n_{11}}\sum_{k=1}^{n_{11}} y_{1,1,k}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(y_{1,1,k}\)</span> is the <span class="math inline">\(k\)</span>th observation in the treatment combination <span class="math inline">\(B1G1\)</span></li>
<li><span class="math inline">\(n_{11}\)</span> is the number of observations in the treatment combination <span class="math inline">\(B1G1\)</span>.</li>
</ul>
<p>And we will let all of the other treatment combinations be represented by the <strong>effects</strong> <span class="math inline">\(\beta_i\)</span> and <span class="math inline">\(\gamma_j\)</span>.</p>
<p>The resulting linear model is:</p>
<p><span class="math display">\[y_{ijk} = intercept + \beta_i + \gamma_j + (\beta\gamma)_{ij} + \epsilon_{ijk} \quad \text{with} \quad \epsilon_{ijk} \sim N(0,\sigma^2)\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(y_{ijk}\)</span> is the <span class="math inline">\(k\)</span>th observation in the treatment combination of <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\((\beta\gamma)_{ij}\)</span> is the interaction effect between the <span class="math inline">\(i\)</span>th level of factor <span class="math inline">\(\beta\)</span> and the <span class="math inline">\(j\)</span>th level of factor <span class="math inline">\(\gamma\)</span>.</li>
</ul>
<p>In this model, we set <span class="math inline">\(\beta_1=\gamma_1=0\)</span> and <span class="math inline">\((\beta\gamma)_{11}=0\)</span> because they are already included in the intercept.</p>
</section>
<section id="using-r-for-2-way-anova" class="level3">
<h3 class="anchored" data-anchor-id="using-r-for-2-way-anova">Using R for 2-way ANOVA</h3>
<p>In R, a two-way ANOVA is as simple as one-way ANOVA, just add another variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bp <span class="sc">~</span> diet <span class="sc">*</span> exercise, <span class="at">data =</span> bp_data_2cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that, as we saw in the chapter about interactions, we include the main effects of diet and exercise and the interaction term with the short hand <code>diet * exercise</code>.</p>
<p>Of course we next check the model diagnostics:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="7-ANOVA_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>No clear patterns: all is good.</p>
</section>
<section id="hypothesis-testing" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-testing">Hypothesis testing</h3>
<p>As is implied by the name “Analysis of variance” we analyse variances, here mean squares, to test hypotheses. And as before we use an <span class="math inline">\(F\)</span>-test to do this. Remember that the <span class="math inline">\(F\)</span>-test is a ratio of two mean squares (where mean squares are a kind of variance).</p>
</section>
</section>
<section id="think-pair-share-1" class="level2 callout-info">
<h2 class="anchored" data-anchor-id="think-pair-share-1">Think, Pair, Share</h2>
<p>How many degrees of freedom for error will there be when we fit this model with both main effects and the interaction term? Hint: remember that the degrees of freedom for error is the number of observations minus the number of parameters estimated.</p>
</section>
<p>We can have have a null hypothesis of no effect for each of the two main effects and for the interaction. So we can do an <span class="math inline">\(F\)</span>-test for each of these null hypotheses.</p>
<p>Here is the ANOVA table:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: bp
              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
diet           2  390.74  195.37  9.9672 0.0002069 ***
exercise       1 1297.52 1297.52 66.1966 5.952e-11 ***
diet:exercise  2  340.67  170.33  8.6901 0.0005346 ***
Residuals     54 1058.46   19.60                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><strong>Interpretation</strong>: All three of the null hypotheses are rejected. Importantly, we see that the interaction term is significant, which means that the effect of one treatment is different depending on the level of the other treatment. This means that even though the main effects are significant, we cannot interpret them without considering the interaction term. I.e., we cannot say anything general about the effect of diet or exercise alone on blood pressure. We have to qualify any statement about the effect of diet or exercise with “depending on the level of the other treatment”. Or state something like “the exercise reduces blood pressure greatly for people with a meat heavy diet, but reduces blood pressure only slightly for people with a vegetarian diet or Mediterranean diet”.</p>
<section id="interpreting-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-coefficients">Interpreting coefficients</h3>
<p>We can look at the estimated coefficients to see the size of the effects, but be aware that it contains only a subset of the possible effects; it would contain different values if a different treatment combination were set to be the intercept of the model. Also be aware that often we are mostly interested in the <span class="math inline">\(F\)</span>-test and their hypotheses test, and are less interest in the coefficients and their <span class="math inline">\(t\)</span>-tests (unlike in a regression model where we are often interested in the coefficients and their <span class="math inline">\(t\)</span>-tests).</p>
<p>Finally, be aware that it needs a bit of work to interpret the coefficients, because they are relative to the intercept. Let’s try to figure out what that means. First, back to the table of the experimental design. This time we will put in the cells an expression for the mean of that treatment combination:</p>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-fymr{border-color:inherit;font-weight:bold;text-align:left;vertical-align:top}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
</style>

<table class="tg">
<thead>
<tr>
<th class="tg-fymr">
</th>
<th class="tg-fymr" colspan="2">
Exercise (G)
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tg-0pky">
Diet (B)
</td>
<td class="tg-0pky">
Low (1)
</td>
<td class="tg-0pky">
High (2)
</td>
</tr>
<tr>
<td class="tg-0pky">
Meat heavy (1)
</td>
<td class="tg-0pky">
<span class="math inline">\(B_1G_1\)</span>
</td>
<td class="tg-0pky">
<span class="math inline">\(B_1G_2\)</span>
</td>
</tr>
<tr>
<td class="tg-0pky">
Mediterranean (2)
</td>
<td class="tg-0pky">
<span class="math inline">\(B_2G_1\)</span>
</td>
<td class="tg-0pky">
<span class="math inline">\(B_2G_2\)</span>
</td>
</tr>
<tr>
<td class="tg-0pky">
Vegetarian (3)
</td>
<td class="tg-0pky">
<span class="math inline">\(B_2G_1\)</span>
</td>
<td class="tg-0pky">
<span class="math inline">\(B_3G_2\)</span>
</td>
</tr>
</tbody>

</table>
<p>So, for example, the mean of the treatment combination “Meat heavy, Low” is <span class="math inline">\(B_1G_1\)</span>. And the mean of the treatment combination “Mediterranean, High” is <span class="math inline">\(B_2G_2\)</span>.</p>
<p>However, the coefficients in the summary table given by R are not like this. They are coefficients relative to an intercept / reference treatment combination. The reference treatment combination chosen by R is the first level of the first factor and the first level of the second factor. In this case, that is “<strong>Meat heavy, Low</strong>” – <span class="math inline">\(B_1G_1\)</span>.</p>
<p>All of the other coefficients are about differences from this reference treatment combination.</p>
<p>So, for example, the coefficient for “High” in the “Exercise” factor (appearing as <code>exercisehigh</code> in the summary table) is the difference in mean blood pressure between the treatment combination “Meat heavy, High” (<span class="math inline">\(B_1G_2\)</span>) and the treatment combination “Meat heavy, Low”. Put another way, <span class="math inline">\(B_1G_2 = B_1G_1 + \gamma_2\)</span> where <span class="math inline">\(\gamma_2\)</span> is the coefficient for “High” in the “Exercise” factor.</p>
<p>And the coefficient for “Mediterranean” in the “Diet” factor (appearing as <code>dietMediterranean</code> in the summary table) is the difference in mean blood pressure between the treatment combination “Mediterranean, Low” and the treatment combination “Meat heavy, Low”. Put another way, <span class="math inline">\(B_2G_1 = B_1G_1 + \beta_2\)</span> where <span class="math inline">\(\beta_2\)</span> is the coefficient for “Mediterranean” in the “Diet” factor.</p>
<p><strong>Let us for a moment assume that the effects of diet and exercise are additive.</strong> If this is the case, then the mean for <span class="math inline">\(B_2G_2\)</span> = <span class="math inline">\(B_1G_1 + \beta_2 + \gamma_2\)</span>. That is, the mean for “Mediterranean, High” is the mean for “Meat heavy, Low” plus the effect of “Mediterranean” plus the effect of “High”.</p>
<p>However, if the effects are not additive, then the mean for <span class="math inline">\(B_2G_2\)</span> is not <span class="math inline">\(B_1G_1 + \beta_2 + \gamma_2\)</span>. Rather, it is <span class="math inline">\(B_2G_2 = B_1G_1 + \beta_2 + \gamma_2 + (\beta\gamma)_{22}\)</span>. That is, the mean for “Mediterranean, High” is the mean for “Meat heavy, Low” <span class="math inline">\(B_1G_1\)</span> plus the effect of “Mediterranean” <span class="math inline">\(\beta_2\)</span> plus the effect of “High” <span class="math inline">\(\gamma_2\)</span> plus the non-additive effect between “Mediterranean” and “High” <span class="math inline">\((\beta\gamma)_{22}\)</span>.</p>
<p>Non-additivity implies an interaction, therefore the non-additive effect is the interaction effect. In the summary table these interaction effects are those that contain a colon (:), e.g., <code>dietMediterranean:exercisehigh</code>.</p>
<p>Here’s a graphical representation of how the coefficients in the summary table relate to the means of the treatment combinations:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/twowayanova1.png" class="img-fluid figure-img" width="300"></p>
<figcaption class="figure-caption">Understanding coefficients</figcaption>
</figure>
</div>
<p>:::{callout, type=“info”} ## Think, Pair, Share</p>
<p>From the values in the coefficients table, calculate the estimated mean of the treatment combination “vegetarian, High”. ::</p>
</section>
<section id="why-not-perform-multiple-t-tests" class="level2">
<h2 class="anchored" data-anchor-id="why-not-perform-multiple-t-tests">Why not perform multiple <span class="math inline">\(t\)</span>-tests?</h2>
<p>To carry out pairwise <span class="math inline">\(t\)</span>-tests between any two groups.</p>
<ul>
<li>How many tests would this imply?</li>
<li>Why is this not a very clever idea?</li>
</ul>
</section>
<section id="summing-up" class="level2">
<h2 class="anchored" data-anchor-id="summing-up">Summing up</h2>
<ul>
<li>ANOVA is just another linear model.</li>
<li>It is used when we have categorical explanatory variables.</li>
<li>We use <span class="math inline">\(F\)</span>-tests to test the null hypothesis of no difference among the means of the groups (categories).</li>
<li>We can use contrasts and post-hoc tests to test specific hypotheses about the means of the groups.</li>
<li>Two-way ANOVA is used when we have two categorical explanatory variables and can be used to test for interactions between them.</li>
</ul>
</section>
<section id="additional-reading" class="level2">
<h2 class="anchored" data-anchor-id="additional-reading">Additional reading</h2>
<p>Please feel free to look at the follow resources for a slightly different perspective and some more information on ANOVA:</p>
<ul>
<li>Chapter 12 from Stahel book <em>Statistische Datenenalyse</em></li>
<li><em>Getting Started with R</em> chapters 5.6 and 6.2</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./6-interactions.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Interactions (L5)</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./8-ANCOVA.html" class="pagination-link">
        <span class="nav-page-text">ANCOVA (L7)</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>